let nowTimeStamp="",lastSecondTime={Hour:"",Time:""},imgSrc1=null,imgSrc2=null;const imgLabel=$("[id^='imgLabel']");let imgLoadingFlag=!1,txtLoadingFlag=!1;function timeRender(){const e=new Date(nowTimeStamp);let t={Hour:e.getHours(),Time:e.toTimeString()};if($("#time").text(t.Time.split(" ")[0]),t.Hour!==lastSecondTime.Hour){switch(t.Hour){case 10:case 11:$("#greeting").text("上午好!");break;case 12:$("#greeting").text("中午好!");break;case 13:case 14:case 15:case 16:case 17:case 18:$("#greeting").text("下午好!");break;case 19:case 20:case 21:case 22:case 23:$("#greeting").text("晚上好!");break;default:$("#greeting").text("早上好!")}lastSecondTime.Hour&&0!==t.Hour||$("#date").text(e.toDateString()+" - ")}lastSecondTime=t,nowTimeStamp+=1e3}function mapRender(e){const n=e.AmapData,t=e.czData;let a="",i=(a=t.city?(-1!==t.city.indexOf("省")&&(t.city=t.city.split("省")[1]||""),n.city&&n.city!==t.city?n.city+(t.city?"/"+t.city:""):t.city):n.city||"不知道哪里","");if(i=t.isp?"本机或本网络"===t.isp?n.isp?" - "+n.isp:" - 代理":n.isp&&n.isp.length>t.isp.length?" - "+n.isp:" - "+t.isp:n.isp?" - "+n.isp:"",$("#address").text(a+" "+(n.district||"")),$("#ip").text(e.IP+i),"中国"!==n.country)return!1;$("#container").attr("hidden",!1),AMapLoader.load({key:"3257a21ceceb0bcd498b8288f0f10cfa",version:"2.0",plugins:["AMap.ToolBar","AMap.Scale","AMap.ControlBar"]}).then(e=>{let t=new e.Map("container",{zoom:8,center:[n.location.split(",")[0],n.location.split(",")[1]],viewMode:"3D",terrain:!0}),a=new e.InfoWindow({anchor:"top-left",content:"猜你在这附近!"});a.open(t,[n.location.split(",")[0],n.location.split(",")[1]]);var i=new e.Marker({position:[n.location.split(",")[0],n.location.split(",")[1]]});t.add(i),t.addControl(new e.ToolBar),t.addControl(new e.Scale),t.addControl(new e.ControlBar)}).catch(e=>{console.error(e)})}function startLoading(e,t){"txt"===e?$("#txtArea").html(t+"<span class ='animate'></span>"):(imgLabel.html("加载中...<span class ='animate'></span>"),$("[id^='imgNode']").attr("src",null))}function imgRender(i,n){return new Promise((e,t)=>{let a=new Image;a.src=n,a.onload=()=>{300<=a.width?$(i).css("width",300).css("height",300*a.height/a.width).attr("src",n):a.width<300&&$(i).css("width",a.width).css("height",a.height).attr("src",n),e(a.width)},a.onerror=e=>{t(e)}})}function resetImgArea(){imgSrc1=null,imgSrc2=null,$("#container1").html("<div id='pointer1'></div><img src='' id='imgNode1'>"),$("#container2").html("<div id='pointer2'></div><img src='' id='imgNode2'>")}function uplaodTxt(e){startLoading("txt","提交中..."),$.ajax({type:"post",url:"https://api.limkim.xyz/test/write",data:{data:e}}).then(e=>{20001===e.success&&$("#txtArea").text("提交成功✔"),txtLoadingFlag=!1}).catch(e=>{txtLoadingFlag=!1,console.error(e)})}function detectAjax(e,s,o){$("#imgLabel"+o).html("正在检测人脸...<span class ='animate'></span>"),$.ajax({type:"post",url:"https://api.limkim.xyz/faceDetect",data:{imgBase64:e}}).then(e=>{if(0===(e=e.data).faces.length)return $("#imgLabel"+o).text("未检测到人脸,换张照片试试吧😜"),imgLoadingFlag=!1;const t=Number($("#imgNode"+o).css("width").split("px")[0]),a=e.faces[0];let i="";Object.keys(a.landmark).forEach(e=>{i+="<span style='left: "+a.landmark[e].x*t/s+"px; top: "+a.landmark[e].y*t/s+"px'></span>"});var e=a.face_rectangle,e=($("#pointer"+o).css("top",(e.top-2)*t/s).css("left",(e.left-2)*t/s).css("width",e.width*t/s).css("height",e.height*t/s).after(i).show(),a.attributes),n="None"===e.glass.value?"未佩戴":"Normal"===e.glass.value?"普通眼镜":"墨镜",r="Male"===e.gender.value?"男":"女";const l=e.emotion;let g="";const c={anger:"愤怒",disgust:"厌恶",fear:"恐惧",happiness:"高兴",neutral:"平静",sadness:"伤心",surprise:"惊讶"};Object.keys(l).forEach(e=>{40<=l[e]&&(g=c[e])}),$("#imgLabel"+o).html("<div class='info'>性别: "+r+"<br>年龄: "+e.age.value+"<br>情绪: "+g+"<br>眼镜: "+n+"<br>颜值打分(男性): "+parseInt(e.beauty.male_score)+" 分<br>颜值打分(女性): "+parseInt(e.beauty.female_score)+" 分</div>"),imgLoadingFlag=!1}).catch(e=>{$("#imgLabel"+o).text("图片体积太大啦,换张照片试试吧😜"),imgLoadingFlag=!1})}(()=>{if($.ajax({type:"get",url:"https://api.limkim.xyz/getSysTime"}).then(e=>{nowTimeStamp=e.Systime2,$(".animate").hide(),timeRender(),setInterval(()=>{timeRender()},1e3)}).catch(e=>{console.error(e)}),$.ajax({type:"get",url:"https://api.limkim.xyz/ipconfig"}).then(e=>{mapRender(e.data)}).catch(e=>{console.error(e)}),console){const e=new gmFactory(4),t=new consoleRender;e.setRenderer(t),t.render(e.tiles,e.actions,!0)}})(),$("#clearInputArea").click(()=>{$("#inputArea").val("")}),$("#uploadTxt").click(()=>{if(txtLoadingFlag)return!1;txtLoadingFlag=!0;var e=$("#inputArea").val();if(""===e||""!==e&&""===$.trim(e))return confirm("输入内容为空,是否继续提交？")?($("#text").val(""),uplaodTxt("")):txtLoadingFlag=!1;uplaodTxt(e)}),$("#readTxt").click(()=>{if(txtLoadingFlag)return!1;txtLoadingFlag=!0,startLoading("txt","加载中..."),$.ajax({type:"get",url:"https://api.limkim.xyz/test/read"}).then(e=>{$("#txtArea").html(""===e.data?"暂无内容📭":e.data),txtLoadingFlag=!1}).catch(e=>{txtLoadingFlag=!1,console.error(e),e.to})}),$("#clearImgArea").click(()=>{imgLabel.text("暂无内容📭"),resetImgArea()}),$("#readImage").click(()=>{if(imgLoadingFlag)return!1;imgLoadingFlag=!0,resetImgArea(),startLoading("img"),$.ajax({type:"get",url:"https://api.limkim.xyz/test/readImage"}).then(e=>{e=e.data;""!==e.src1?(imgRender("#imgNode1",e.src1),imgSrc1=e.src1,$("#imgLabel1").text("加载成功✔")):(imgSrc1=null,$("#imgLabel1").text("暂无图片1信息📭")),""!==e.src2?(imgRender("#imgNode2",e.src2),imgSrc2=e.src2,$("#imgLabel2").text("加载成功✔")):(imgSrc2=null,$("#imgLabel2").text("暂无图片2信息📭")),imgLoadingFlag=!1}).catch(e=>{imgLoadingFlag=!1,console.error(e)})}),$("#deleteImage").click(()=>{if(imgLoadingFlag)return!1;imgLoadingFlag=!0,startLoading("img","删除中..."),$.ajax({type:"get",url:"https://api.limkim.xyz/test/deleteImage"}).then(e=>{20001===e.success&&(imgLabel.text("删除成功✔"),resetImgArea()),imgLoadingFlag=!1}).catch(()=>{imgLoadingFlag=!1,console.error(err)})}),$("[id^='inputDiv']").click(e=>{e="上传图片1"===e.target.innerText?1:2;$("#fileInput"+e).trigger("click")}),$("[id^='fileInput']").change(e=>{if(imgLoadingFlag)return!1;imgLoadingFlag=!0;const t="fileInput1"===e.target.id?1:2;$("#container"+t).html("<div id='pointer"+t+"'></div><img src='' id='imgNode"+t+"'>"),$("#imgNode"+t).attr("src",null),$("imgLabrl"+t).text("读取中...<span class ='animate'></span>");e=document.querySelector("#fileInput"+t).files[0];document.querySelector("#fileInput"+t).value="";let a,i=new FileReader;i.readAsDataURL(e),i.onerror=e=>{console.error(e),imgLoadingFlag=!1},i.onload=()=>{a=i.result,$("#imgLabel"+t).html("提交中...<span class ='animate'></span>"),$.ajax({type:"post",url:"https://api.limkim.xyz/test/uploadImage",data:{index:t,src:a}}).then(async()=>{let e=1;e=1==t?await imgRender("#imgNode1",imgSrc1=a):await imgRender("#imgNode2",imgSrc2=a),detectAjax(a,e,t)}).catch(e=>{413===e.status&&$("#imgLabel"+t).text("图片体积太大啦,换张照片试试吧😜"),imgLoadingFlag=!1})}}),$("[id^='recognizeImg']").click(e=>{if(imgLoadingFlag)return!1;const t="recognizeImg1"===e.target.id?1:2;if(1==t&&null===imgSrc1)return $("#imgLabel1").text("暂无图片1信息📭"),!1;if(2==t&&null===imgSrc2)return $("#imgLabel2").text("暂无图片2信息📭"),!1;imgLoadingFlag=!0,image_base64=1==t?imgSrc1:imgSrc2;let a=new Image;a.src=image_base64,a.onload=()=>{detectAjax(image_base64,a.width,t)}}),$("#compareImg").click(()=>{if(imgLoadingFlag)return!1;"暂无内容📭"!==$("#imgLabel1").text()&&imgSrc1||$("#imgLabel1").text("暂无图片1信息📭"),"暂无内容📭"!==$("#imgLabel2").text()&&imgSrc2||$("#imgLabel2").text("暂无图片2信息📭"),"暂无图片1信息📭"!==$("#imgLabel1").text()&&"暂无图片2信息📭"!==$("#imgLabel2").text()&&(imgLoadingFlag=!0,$("[id^='imgLabel']").html("上传比对中...<span class ='animate'></span>"),$.ajax({type:"post",url:"https://api-cn.faceplusplus.com/facepp/v3/compare",data:{api_key:"PRNA1wgDSB9iCn0oVW6RMDiRNpU42SzF",api_secret:"yNRiYEIr0ZS_TsTSqEUI29wq3orEiQKb",image_base64_1:imgSrc1,image_base64_2:imgSrc2}}).then(e=>{void 0!==e.confidence?$("[id^='imgLabel']").text("相似比为: "+e.confidence+"%"):0===e.faces1.length&&0!==e.faces2.length?($("#imgLabel1").text("未检测到人脸,换张照片试试吧😜"),$("#imgLabel2").text("比对失败✘")):0===e.faces2.length&&0!==e.faces1.length?($("#imgLabel1").text("比对失败✘"),$("#imgLabel2").text("未检测到人脸,换张照片试试吧😜")):0===e.faces1.length&&0===e.faces2.length&&($("#imgLabel1").text("未检测到人脸,换张照片试试吧😜"),$("#imgLabel2").text("未检测到人脸,换张照片试试吧😜")),imgLoadingFlag=!1}).catch(()=>{imgLoadingFlag=!1,$("[id^='imgLabel']").text("图片1或图片2体积太大啦,换张照片试试吧😜")}))});