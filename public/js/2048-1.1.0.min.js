const gmFactory=function(f){let d,p,l=d=0,c=2048,u=[],g=[],s={start:[],end:[],move:[]},e;return(e={init:function(e,t){p=new Array(e*e),f=e;for(let e=0;e<p.length;e++)p[e]=0;for(t&&(c=t),Object.defineProperty(this,"tiles",{get:function(){return p}}),Object.defineProperty(this,"actions",{get:function(){return u}}),Object.defineProperty(this,"highestScore",{get:function(){return l}}),Object.defineProperty(this,"moves",{get:function(){return d}}),Object.defineProperty(this,"maxScores",{get:function(){return c}}),i=0;i<6;i++)this.randomVal()},randomVal:function(){let t=[];for(let e=0;e<p.length;e++)0==p[e]&&t.push(e);if(t.length<1)return!1;var e=t[Math.floor(Math.random()*t.length)];p[e]=Math.random()<.8?2:4,u.push({type:"create",index:e,value:p[e]})},move:function(t){let n,o,r;u=[],"up"===t?(n=0,o=1,r=f):"left"===t?(n=0,o=f,r=1):"down"===t?(n=p.length-1,o=-1,r=-f):"right"===t&&(n=p.length-1,o=-f,r=-1),d++;var e=p.length-1-n;let i=n,l=[];for(let e=0;e<p.length;e++)l[e]=p[e];g.push(l);let c=0;for(;0!=e&&i<e||0==e&&0<i&&c<f;){let e=i;for(;!this.isAtEdge(t,i);){e+=r;var s=p[e],h=p[i],a=this.swallowUp(e,i);if(a||!a&&0!=s&&0!=h)i+=r,e=i;else if(this.isAtEdge(t,e)){i=e;break}}n+=o,c++,i=n}this.randomVal()},isAtEdge:function(e,t){var n=f-1,o=f-1,r=p.length-f;switch(e){case"down":return t<=o;case"up":return r<=t;case"left":return t%f==n;case"right":return t%f==0}},swallowUp:function(e,t){var n,o=p[e],r=p[t];return 0!=o&&((o==r||0==r)&&(n=o+r,p[t]=n,p[e]=0,u.push({type:"move",from:{index:e,value:o},to:{index:t,value:n}}),(l=Math.max(l,n))==c&&(this.init(f),this.fireEvent("end",this)),0!=r))},back:function(){g.length<1||(p=g.pop(),this.render())},setRenderer:function(e){(this.renderer=e).init(this)},render:function(){this.renderer.render(this.tiles,u)},on:function(t,n,o){if(s[t]){let e=s[t];e.push({fn:n,scope:o})}},un:function(e,n,o){if(s[e]){let t=s[e];if(!(t.length<1))for(let e=0;e<t.length;e++){var r=t[e];if(r.fn==n&&r.scope==o){t.splice(e,1);break}}}},fireEvent:function(){var e=arguments[0],n=arguments.slice(1),o=s[e];if(o&&!(o.length<1))for(let t=0;t<o.length;t++){let e=o[t];"function"==typeof e.fn&&e.fn.apply(e.scope,n)}}}).init(f),e};let consoleRender=function(){};consoleRender.prototype.map={87:"up",83:"down",65:"left",68:"right",37:"left",38:"up",39:"right",40:"down",90:"z"},consoleRender.prototype.game=null,consoleRender.prototype.colorPalette=function(e){var t=["#eee4da","#ede0c8","#f2b179","#f59563","#f67c5f","#f65e3b","#edcf72","#edcc61","#edc850","#edc53f","#edc22e"];let n={};var o=e.split(","),r=o.length;for(let e=0;e<r;e++)n[o[e]]="background-color:"+t[e]+";";return n},consoleRender.prototype.pad=function(e,t){for(e=(e||" ")+"";t>e.length;)e=" "+e+" ";return e=e.length>t?e.slice(0,t-e.length):e},consoleRender.prototype.render=function(r,t,e){e||console.clear(),console.log(" ");var i=Math.sqrt(r.length),l=this.colorPalette("2,4,8,16,32,64,128,256,512,1024,2048");for(let o=0;o<i;o+=1){let t=[],n=[];for(let e=0;e<i;e++){var c=r[i*o+e];t.push("%c"+this.pad(c,4)+"%c"),n.push("text-align:center;width:100px;display:block;background-color:#ccc;padding:4px 7px;line-height:1.4;color:#000;font-size:14px;"+(l[c]||"")),n.push("")}t.push("%c"+Math.random()),n.push("padding-left:50px;dispaly:none;color:white;line-height:1.3"),console.log.apply(console,[t.join("")].concat(n))}let n=[];for(let e=0;e<t.length;e++){var o=t[e];"move"===o.type?n.push("#"+o.from.index+"->#"+o.to.index):n.push(o.value+" created at #"+o.index)}console.log("actions: "+n.join(" , ")+" , highestScore:"+this.game.highestScore)},consoleRender.prototype.keydownHandler=function(e){e=e.keyCode||e.which;if(this.started){if(this.map[e]){if("z"===this.map[e])return this.game.back();this.game.move(this.map[e]),this.game.render()}}else 13===e&&(this.started=!0,this.game.render())},consoleRender.prototype.init=function(e){console.log("%c芜湖~! 感谢访问俺滴小破站, 既然打开了控制台, 那就试试在这里玩2048吧!%c","color:#999;font-family:幼圆;font-size:14px","");console.log.apply(console,["点击一下网页空白处, 确保焦点在网页上, 并敲击 %c回车%c 开始游戏, 你可以使用 %c方向键%c 或者 %cW A S D%c 来控制。","color:red;font-weight:bold;","","color:red;font-weight:bold;","","color:red;font-weight:bold;",""]),this.game=e,"function"==typeof $?$(window).on("keydown",$.proxy(this.keydownHandler,this)):window.addEventListener=this.keydownHandler.bind(this)};