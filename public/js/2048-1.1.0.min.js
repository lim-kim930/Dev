const gmFactory=function(a){let d,p,r=d=0,l=2048,u=[],g=[],c={start:[],end:[],move:[]},e;return(e={init:function(e,t){p=new Array(e*e),a=e;for(let e=0;e<p.length;e++)p[e]=0;for(t&&(l=t),Object.defineProperty(this,"tiles",{get:function(){return p}}),Object.defineProperty(this,"actions",{get:function(){return u}}),Object.defineProperty(this,"highestScore",{get:function(){return r}}),Object.defineProperty(this,"moves",{get:function(){return d}}),Object.defineProperty(this,"maxScores",{get:function(){return l}}),i=0;i<6;i++)this.randomVal()},randomVal:function(){let t=[];for(let e=0;e<p.length;e++)0==p[e]&&t.push(e);if(t.length<1)return!1;var e=t[Math.floor(Math.random()*t.length)];p[e]=Math.random()<.8?2:4,u.push({type:"create",index:e,value:p[e]})},move:function(t){let n,o,i;u=[],"up"===t?(n=0,o=1,i=a):"left"===t?(n=0,o=a,i=1):"down"===t?(n=p.length-1,o=-1,i=-a):"right"===t&&(n=p.length-1,o=-a,i=-1),d++;var e=p.length-1-n;let r=n,l=[];for(let e=0;e<p.length;e++)l[e]=p[e];g.push(l);let c=0;for(;0!=e&&r<e||0==e&&0<r&&c<a;){let e=r;for(;!this.isAtEdge(t,r);){e+=i;var f=p[e],s=p[r],h=this.swallowUp(e,r);if(h||!h&&0!=f&&0!=s)r+=i,e=r;else if(this.isAtEdge(t,e)){r=e;break}}n+=o,c++,r=n}this.randomVal()},isAtEdge:function(e,t){var n=a-1,o=a-1,i=p.length-a;switch(e){case"down":return t<=o;case"up":return i<=t;case"left":return t%a==n;case"right":return t%a==0}},swallowUp:function(e,t){var n,o=p[e],i=p[t];return 0!=o&&((o==i||0==i)&&(n=o+i,p[t]=n,p[e]=0,u.push({type:"move",from:{index:e,value:o},to:{index:t,value:n}}),(r=Math.max(r,n))==l&&(this.init(a),this.fireEvent("end",this)),0!=i))},back:function(){g.length<1||(p=g.pop(),this.render())},setRenderer:function(e){(this.renderer=e).init(this)},render:function(){this.renderer.render(this.tiles,u)},on:function(t,n,o){if(c[t]){let e=c[t];e.push({fn:n,scope:o})}},un:function(e,n,o){if(c[e]){let t=c[e];if(!(t.length<1))for(let e=0;e<t.length;e++){var i=t[e];if(i.fn==n&&i.scope==o){t.splice(e,1);break}}}},fireEvent:function(){var e=arguments[0],n=arguments.slice(1),o=c[e];if(o&&!(o.length<1))for(let t=0;t<o.length;t++){let e=o[t];"function"==typeof e.fn&&e.fn.apply(e.scope,n)}}}).init(a),e};let consoleRender=function(){};consoleRender.prototype.map={87:"up",83:"down",65:"left",68:"right",37:"left",38:"up",39:"right",40:"down",90:"z"},consoleRender.prototype.game=null,consoleRender.prototype.colorPalette=function(e){var t=["#eee4da","#ede0c8","#f2b179","#f59563","#f67c5f","#f65e3b","#edcf72","#edcc61","#edc850","#edc53f","#edc22e"];let n={};var o=e.split(","),i=o.length;for(let e=0;e<i;e++)n[o[e]]="background-color:"+t[e]+";";return n},consoleRender.prototype.pad=function(e,t){for(e=(e||" ")+"";t>e.length;)e=" "+e+" ";return e=e.length>t?e.slice(0,t-e.length):e},consoleRender.prototype.render=function(i,t,e){e||console.clear(),console.log(" ");var r=Math.sqrt(i.length),l=this.colorPalette("2,4,8,16,32,64,128,256,512,1024,2048");for(let o=0;o<r;o+=1){let t=[],n=[];for(let e=0;e<r;e++){var c=i[r*o+e];t.push("%c"+this.pad(c,4)+"%c"),n.push("text-align:center;width:100px;display:block;background-color:#ccc;padding:4px 7px;line-height:1.4;color:#000;font-size:14px;"+(l[c]||"")),n.push("")}t.push("%c"+Math.random()),n.push("padding-left:50px;dispaly:none;color:white;line-height:1.3"),console.log.apply(console,[t.join("")].concat(n))}let n=[];for(let e=0;e<t.length;e++){var o=t[e];"move"===o.type?n.push("#"+o.from.index+"->#"+o.to.index):n.push(o.value+" created at #"+o.index)}console.log("actions: "+n.join(" , ")+" , highestScore:"+this.game.highestScore)},consoleRender.prototype.keydownHandler=function(e){e=e.keyCode||e.which;if(this.started){if(this.map[e]){if("z"===this.map[e])return this.game.back();this.game.move(this.map[e]),this.game.render()}}else 13===e&&(this.started=!0,this.game.render())},consoleRender.prototype.init=function(e){console.log("%c芜湖~! 感谢访问俺滴小破站, 既然打开了控制台, 那就试试在这里玩2048吧!%c","color:#999;font-family:幼圆;font-size:14px","");console.log.apply(console,["%c点击一下网页空白处, 确保焦点在网页上, 并敲击%c %c回车%c %c开始游戏, 你可以使用%c %c方向键%c %c或者%c %cW A S D%c %c来控制, 也可以使用%c %cZ%c %c来回退操作.%c","color:#999;font-family:幼圆;font-size:14px","","color:red;font-weight:bold;font-family:幼圆;font-size:14px","","color:#999;font-family:幼圆;font-size:14px","","color:red;font-weight:bold;font-family:幼圆;font-size:14px","","color:#999;font-family:幼圆;font-size:14px","","color:red;font-weight:bold;font-family:幼圆;font-size:14px","","color:#999;font-family:幼圆;font-size:14px","","color:red;font-weight:bold;font-family:幼圆;font-size:14px","","color:#999;font-family:幼圆;font-size:14px",""]),this.game=e,"function"==typeof $?$(window).on("keydown",$.proxy(this.keydownHandler,this)):window.addEventListener=this.keydownHandler.bind(this)};